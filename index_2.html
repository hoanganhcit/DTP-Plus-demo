<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DTP Plus - Thư Viện Thiết Kế Nội Bộ</title>
    <meta name="description" content="DTP Plus - Thư Viện Thiết Kế Nội Bộ">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.png">
    <link href="https://kit-pro.fontawesome.com/releases/v5.15.3/css/pro.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --color-primary: #eaa659;
            --color-secondary: #161f44;
        }

        .hero-bg {
            background:
                radial-gradient(1200px 600px at 20% -10%, color-mix(in srgb, var(--color-primary) 35%, transparent), transparent 60%),
                radial-gradient(900px 500px at 80% -20%, color-mix(in srgb, var(--color-secondary) 20%, transparent), transparent 55%),
                linear-gradient(180deg, #f8fafc 0%, color-mix(in srgb, var(--color-primary) 10%, #ffffff) 45%, #f8fafc 100%);
        }

        .theme-text {
            color: var(--color-secondary);
        }

        .theme-muted {
            color: color-mix(in srgb, var(--color-secondary) 70%, #9ca3af 30%);
        }

        .theme-accent {
            color: var(--color-primary);
        }

        .btn-primary {
            background: var(--color-primary);
            color: #ffffff;
        }

        .btn-primary:hover {
            filter: brightness(0.95);
        }

        .btn-outline {
            border: 1px solid rgba(148, 163, 184, 0.45);
            color: var(--color-secondary);
        }

        .btn-outline:hover {
            border-color: var(--color-primary);
            color: var(--color-secondary);
        }

        .card-hover:hover {
            border-color: var(--color-primary);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.25);
            backdrop-filter: blur(16px);
        }

        .mega-menu {
            opacity: 0;
            visibility: hidden;
            transform: translateY(8px);
            transition: all 0.2s ease;
            background: #ffffff;
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 18px 50px rgba(15, 23, 42, 0.08);
            border-radius: 0;
            width: 100vw;
            left: 0;
            right: 0;
        }

        .mega-menu.is-open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .modal-open {
            overflow: hidden;
        }
    </style>
</head>

<body class="hero-bg theme-text">
    <div class="fixed inset-0 hero-bg -z-10"></div>

    <header class="fixed top-0 inset-x-0 z-40 bg-white/80 border-b border-slate-200/60 backdrop-blur">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="index_2.html" class="d-block">
                    <img src="logo.png" alt="Logo" class="h-10 object-contain">
                </a>
            </div>
            <nav class="hidden lg:flex items-center gap-6" id="main-nav">
                <!-- Nav items load từ dữ liệu -->
            </nav>
            <div class="flex items-center gap-2">
                <button id="mobile-menu-btn" class="lg:hidden px-3 py-2 border border-slate-300/70 rounded-lg text-sm">Danh mục</button>
                <div class="hidden md:flex items-center gap-2 text-xs text-slate-500">
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                    Online nội bộ
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="lg:hidden border-t border-slate-200 bg-white/95 hidden">
            <div class="px-6 py-4" id="mobile-menu-content"></div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 pt-28 pb-12">
        <section class="mb-10">
            <div class="max-w-3xl">
                <p class="text-xs uppercase tracking-[0.4em] text-slate-500">Source Design</p>
                <h2 class="text-3xl md:text-4xl font-semibold mt-2">Thư viện thiết kế nội bộ</h2>
                <p class="text-sm text-slate-600 mt-3">Chọn danh mục từ thanh điều hướng, duyệt thiết kế và tải nhanh phục vụ dự án. Giao diện tối ưu cho dữ liệu lớn.</p>
            </div>
            <div class="mt-6 flex flex-wrap items-center gap-3">
                <div class="glass-card rounded-xl hidden px-4 py-3 flex items-center gap-3 w-full md:w-auto md:min-w-[320px]">
                    <input id="search-input" type="text" placeholder="Tìm theo tên file..." class="w-full bg-transparent text-sm text-slate-800 placeholder-slate-400 outline-none">
                </div>
                <div class="text-xs text-slate-500 hidden">Đang xem: <span id="breadcrumb" class="font-medium text-slate-800"></span></div>
            </div>
        </section>

        <section class="grid lg:grid-cols-[280px_1fr] gap-6">
            <aside class="space-y-4">
                <div id="subcategory-info" class="glass-card rounded-2xl p-5 hidden mb-4">
                    <div class="space-y-2">
                        <div>
                            <h3 id="subcategory-title" class="text-lg font-semibold capitalize">Chọn danh mục</h3>
                            <p id="subcategory-desc" class="text-sm text-slate-600">Vui lòng chọn danh mục trong thanh điều hướng để xem thiết kế.</p>
                        </div>
                        <div class="text-xs text-slate-500">
                            Số lượng file: <span id="stat-categories" class="text-slate-800 font-medium">0</span>
                        </div>
                    </div>
                </div>
                <div class="glass-card rounded-2xl p-5 !mt-0">
                    <div class="text-xs font-semibold text-slate-600 uppercase tracking-wide mb-3">Danh mục</div>
                    <div id="sidebar-menu" class="space-y-3"></div>
                </div>
            </aside>

            <section id="content" class="space-y-6">
                <!-- Content load từ js -->
            </section>
        </section>
    </main>

    <div id="image-modal" class="fixed inset-0 bg-slate-900/60 overflow-auto hidden items-center justify-center z-50">
        <div class="bg-white p-4 relative ">
            <div class="flex flex-wrap items-center justify-between gap-3 pb-4 mb-4 border-b border-slate-200">
                <div>
                    <h3 id="modal-title" class="text-base font-semibold">Tên ảnh</h3>
                    <p id="modal-path" class="text-xs text-slate-500 break-all"></p>
                </div>
                <div>
                    <a id="modal-download" href="#"  class="btn-primary px-4 py-2 rounded-lg text-sm">Tải về</a>
                    <a id="modal-close" href="#"  class="btn-outline px-4 py-2 rounded-lg text-sm">Đóng</a>
                </div>
            </div>
            <div class="space-y-4 ">
                <div class="mb-4 flex justify-center">
                    <img id="modal-image" src="" alt="" class="">
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = {};

        const nav = document.getElementById("main-nav");
        const mobileMenuContent = document.getElementById("mobile-menu-content");
        const sidebarMenu = document.getElementById("sidebar-menu");
        const content = document.getElementById("content");
        const breadcrumb = document.getElementById("breadcrumb");
        const searchInput = document.getElementById("search-input");
        const statCategories = document.getElementById("stat-categories");
        const subcategoryInfo = document.getElementById("subcategory-info");
        const subcategoryTitle = document.getElementById("subcategory-title");
        const subcategoryDesc = document.getElementById("subcategory-desc");
        const modal = document.getElementById("image-modal");
        const modalImage = document.getElementById("modal-image");
        const modalTitle = document.getElementById("modal-title");
        const modalPath = document.getElementById("modal-path");
        const modalClose = document.getElementById("modal-close");

        let activeParent = null;
        let activeNode = null;
        let currentPage = 1;
        const pageSize = 4;
        let navOutsideListenerBound = false;

        const sampleData = {
            Design_01: {
                label: "Design_01",
                tree: {
                    label: "Design_01",
                    path: "01_Design",
                    files: [],
                    children: [
                        {
                            label: "dtp-01",
                            path: "01_Design/dtp-01",
                            files: [],
                            children: [
                                {
                                    label: "Basic",
                                    path: "01_Design/dtp-01/Basic",
                                    files: [],
                                    children: []
                                },
                                {
                                    label: "Medium",
                                    path: "01_Design/dtp-01/Medium",
                                    files: [],
                                    children: []
                                },
                                {
                                    label: "Pro",
                                    path: "01_Design/dtp-01/Pro",
                                    files: [],
                                    children: [
                                        {
                                            label: "TD01",
                                            path: "01_Design/dtp-01/Pro/TD01",
                                            files: [
                                                "TD01-001.jpg",
                                                "TD01-002.jpg",
                                                "TD01-003.jpg",
                                                "TD01-004.jpg",
                                                "TD01-005.jpg"
                                            ],
                                            children: []
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            },
            Documents: {
                label: "Documents",
                tree: {
                    label: "Documents",
                    path: "Documents",
                    files: [],
                    children: [
                        {
                            label: "dtp-01",
                            path: "Documents/dtp-01",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Documents/dtp-01/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Documents/dtp-01/medium",
                                    files: ["Asset 2.png", "Asset 3.png", "Asset 4.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Documents/dtp-01/pro",
                                    files: ["Asset 2.png", "Asset 3.png", "Asset 4.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "dtp-02",
                            path: "Documents/dtp-02",
                            files: [],
                            children: []
                        },
                        {
                            label: "dtp-03",
                            path: "Documents/dtp-03",
                            files: [],
                            children: []
                        }
                    ]
                }
            },
            Illustrator: {
                label: "Illustrator",
                tree: {
                    label: "Illustrator",
                    path: "Illustrator",
                    files: [],
                    children: [
                        {
                            label: "catalogue",
                            path: "Illustrator/catalogue",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Illustrator/catalogue/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Illustrator/catalogue/medium",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Illustrator/catalogue/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png", "Asset 4.png", "Asset 5.png", "Asset 6.png", "Asset 7.png", "Asset-8.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "menu",
                            path: "Illustrator/menu",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Illustrator/menu/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Illustrator/menu/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Illustrator/menu/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "poster",
                            path: "Illustrator/poster",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Illustrator/poster/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Illustrator/poster/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Illustrator/poster/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "standee",
                            path: "Illustrator/standee",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Illustrator/standee/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Illustrator/standee/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Illustrator/standee/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        }
                    ]
                }
            },
            InDesign: {
                label: "InDesign",
                tree: {
                    label: "InDesign",
                    path: "InDesign",
                    files: [],
                    children: [
                        {
                            label: "catalogue",
                            path: "InDesign/catalogue",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "InDesign/catalogue/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "InDesign/catalogue/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "InDesign/catalogue/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "menu",
                            path: "InDesign/menu",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "InDesign/menu/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "InDesign/menu/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "InDesign/menu/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "poster card",
                            path: "InDesign/poster card",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "InDesign/poster card/basic",
                                    files: ["Asset 1.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "InDesign/poster card/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "InDesign/poster card/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        }
                    ]
                }
            },
            Photoshop: {
                label: "Photoshop",
                tree: {
                    label: "Photoshop",
                    path: "Photoshop",
                    files: [],
                    children: [
                        {
                            label: "banner",
                            path: "Photoshop/banner",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Photoshop/banner/basic",
                                    files: ["Asset 6.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Photoshop/banner/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Photoshop/banner/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "book",
                            path: "Photoshop/book",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Photoshop/book/basic",
                                    files: ["Asset 6.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Photoshop/book/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Photoshop/book/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        },
                        {
                            label: "logo",
                            path: "Photoshop/logo",
                            files: [],
                            children: [
                                {
                                    label: "basic",
                                    path: "Photoshop/logo/basic",
                                    files: ["Asset 6.png"],
                                    children: []
                                },
                                {
                                    label: "medium",
                                    path: "Photoshop/logo/medium",
                                    files: ["Asset 2.png"],
                                    children: []
                                },
                                {
                                    label: "pro",
                                    path: "Photoshop/logo/pro",
                                    files: ["Asset 1.png", "Asset 2.png", "Asset 3.png"],
                                    children: []
                                }
                            ]
                        }
                    ]
                }
            }
        };

        const normalizePath = (path) => encodeURI(path);
        const countFilesRecursive = (node) => {
            const direct = node.files?.length || 0;
            const children = node.children?.reduce((sum, child) => sum + countFilesRecursive(child), 0) || 0;
            return direct + children;
        };

        const setActiveNode = (parentKey, node) => {
            activeParent = parentKey;
            activeNode = node;
            currentPage = 1;
            subcategoryInfo.classList.remove("hidden");
            renderContent();
        };

        const createNodeItem = (parentKey, node, depth = 0, onSelect = null) => {
            const wrapper = document.createElement("div");
            wrapper.className = "space-y-2";

            const row = document.createElement("div");
            row.className = "flex items-center justify-between gap-2";

            const labelBtn = document.createElement("button");
            labelBtn.className = "flex-1 text-left text-sm text-slate-600 hover:text-slate-900 capitalize";
            labelBtn.style.paddingLeft = `${depth * 12}px`;
            const totalFiles = countFilesRecursive(node);
            labelBtn.innerHTML = `${node.label} <span class=\"text-xs text-slate-400\">(${totalFiles})</span>`;
            labelBtn.addEventListener("click", () => {
                setActiveNode(parentKey, node);
                if (onSelect) {
                    onSelect();
                }
            });

            row.appendChild(labelBtn);

            if (node.children && node.children.length) {
                const toggle = document.createElement("button");
                toggle.className = "text-xs text-slate-400 px-2";
                toggle.textContent = "▸";
                row.appendChild(toggle);

                const childContainer = document.createElement("div");
                childContainer.className = "space-y-2 mt-2 hidden";
                node.children.forEach((child) => {
                    childContainer.appendChild(createNodeItem(parentKey, child, depth + 1, onSelect));
                });

                toggle.addEventListener("click", () => {
                    childContainer.classList.toggle("hidden");
                    toggle.textContent = childContainer.classList.contains("hidden") ? "▸" : "▾";
                });

                wrapper.appendChild(row);
                wrapper.appendChild(childContainer);
            } else {
                wrapper.appendChild(row);
            }

            return wrapper;
        };

        const createFlatListItem = (parentKey, node, depth = 0) => {
            const item = document.createElement("div");
            item.className = "flex items-center gap-2";

            const button = document.createElement("button");
            button.className = "flex capitalize text-left text-sm text-slate-600 hover:text-slate-900";
            button.style.paddingLeft = `${depth * 10}px`;
            const totalFiles = countFilesRecursive(node);
            button.innerHTML = `${node.label} <span class=\"mx-1 text-xs text-slate-400\">(${totalFiles})</span>`;
            button.addEventListener("click", () => {
                setActiveNode(parentKey, node);
            });

            item.appendChild(button);

            const children = node.children || [];
            const container = document.createElement("div");
            container.className = "space-y-2";
            children.forEach((child) => {
                container.appendChild(createFlatListItem(parentKey, child, depth + 1));
            });

            const wrapper = document.createElement("div");
            wrapper.className = "space-y-2";
            wrapper.appendChild(item);
            if (children.length) {
                wrapper.appendChild(container);
            }

            return wrapper;
        };

        const getPreviewUrl = (filePath) => {
            const ext = filePath.split(".").pop()?.toLowerCase();
            if (ext === "ai") {
                return `/api/preview?path=${encodeURIComponent(filePath)}`;
            }
            return `DTP_FILES/${filePath}`;
        };

        const getDownloadUrl = (filePath) => {
            const lastDot = filePath.lastIndexOf(".");
            const baseName = lastDot > -1 ? filePath.slice(0, lastDot) : filePath;
            return `download/${baseName}.zip`;
        };

        const createMegaColumn = (parentKey, node) => {
            const column = document.createElement("div");
            column.className = "space-y-2  bg-slate-100 rounded-md px-4 py-4 gap-2";

            const title = document.createElement("div");
            title.className = "text-xs font-semibold text-slate-600 uppercase tracking-wide mb-4";
            title.innerHTML = `<span class="text-slate-500 fas fa-folder text-amber-400 mr-2"></span><span>${node.label}</span>`;

            const list = document.createElement("div");
            list.className = "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6";
            (node.children || []).forEach((child) => {
                list.appendChild(createFlatListItem(parentKey, child, 0));
            });

            if (!list.childElementCount) {
                list.appendChild(createFlatListItem(parentKey, node, 0));
            }

            column.appendChild(title);
            column.appendChild(list);
            return column;
        };

        const buildNav = () => {
            nav.innerHTML = "";
            mobileMenuContent.innerHTML = "";
            sidebarMenu.innerHTML = "";
            statCategories.textContent = "0";

            const closeAllMega = () => {
                document.querySelectorAll(".mega-menu.is-open").forEach((menu) => {
                    menu.classList.remove("is-open");
                });
            };

            Object.entries(data).forEach(([parentKey, parentValue]) => {
                const navItem = document.createElement("div");
                navItem.className = "nav-item";

                const navBtn = document.createElement("button");
                navBtn.className = `text-sm font-medium ${activeParent === parentKey ? "text-slate-900" : "text-slate-600 hover:text-slate-900"}`;
                navBtn.textContent = parentValue.label;
                navItem.appendChild(navBtn);

                const mega = document.createElement("div");
                mega.className = "mega-menu absolute mt-4 py-6 max-h-[70vh] overflow-auto";
                const inner = document.createElement("div");
                inner.className = "max-w-7xl mx-auto px-6";
                const columns = document.createElement("div");
                columns.className = "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6";
                const treeRoot = parentValue.tree;
                treeRoot.children.forEach((node) => {
                    columns.appendChild(createMegaColumn(parentKey, node));
                });
                inner.appendChild(columns);
                mega.appendChild(inner);
                navItem.appendChild(mega);
                nav.appendChild(navItem);

                navBtn.addEventListener("click", (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    const isOpen = mega.classList.contains("is-open");
                    closeAllMega();
                    if (!isOpen) {
                        mega.classList.add("is-open");
                    }
                });

                const mobileSection = document.createElement("div");
                mobileSection.className = "mb-4";
                mobileSection.innerHTML = `<div class=\"font-semibold mb-2 text-slate-900 capitalize\">${parentValue.label}</div>`;
                const mobileList = document.createElement("div");
                mobileList.className = "space-y-2";
                parentValue.tree.children.forEach((node) => {
                    mobileList.appendChild(createNodeItem(parentKey, node, 0, () => {
                        document.getElementById("mobile-menu").classList.add("hidden");
                    }));
                });
                mobileSection.appendChild(mobileList);
                mobileMenuContent.appendChild(mobileSection);

                const sidebarSection = document.createElement("div");
                sidebarSection.className = "space-y-2";
                sidebarSection.innerHTML = `<div class=\"text-sm font-semibold text-slate-800 capitalize\">${parentValue.label}</div>`;
                const sidebarList = document.createElement("div");
                sidebarList.className = "space-y-2 bg-zinc-50 px-4 py-4 rounded-xl";
                parentValue.tree.children.forEach((node) => {
                    sidebarList.appendChild(createNodeItem(parentKey, node, 0));
                });
                sidebarSection.appendChild(sidebarList);
                sidebarMenu.appendChild(sidebarSection);
            });

            if (!navOutsideListenerBound) {
                document.addEventListener("click", closeAllMega);
                navOutsideListenerBound = true;
            }
        };

        const renderContent = () => {
            if (!activeParent || !activeNode) {
                content.innerHTML = "";
                subcategoryInfo.classList.add("hidden");
                statCategories.textContent = "0";
                const empty = document.createElement("div");
                empty.className = "glass-card border border-dashed border-zinc-50 rounded-2xl text-center text-slate-500";
                empty.innerHTML = `
                    <img src="bg.png" alt="Background" class="mb-4 rounded-2xl">
                    <div class="text-sm mb-4">Vui lòng chọn danh mục để xem thiết kế.</div>
                `;
                content.appendChild(empty);
                return;
            }

            const parent = data[activeParent];
            const relativePath = activeNode.path.startsWith(`${activeParent}/`)
                ? activeNode.path.slice(activeParent.length + 1)
                : activeNode.path;
            const pathText = relativePath ? `${parent.label} / ${relativePath}` : parent.label;
            breadcrumb.textContent = pathText;
            subcategoryTitle.textContent = relativePath || activeNode.label;
            subcategoryDesc.textContent = activeNode.files.length
                ? "Chọn ảnh để xem chi tiết hoặc tải về."
                : "Danh mục này hiện chưa có dữ liệu.";

            content.innerHTML = "";

            if (!activeNode.files.length) {
                const empty = document.createElement("div");
                empty.className = "glass-card border border-dashed border-slate-200 rounded-2xl p-10 text-center text-slate-500";
                empty.textContent = "Chưa có thiết kế trong danh mục này.";
                content.appendChild(empty);
                statCategories.textContent = "0";
                return;
            }

            const keyword = searchInput.value.trim().toLowerCase();
            const filteredFiles = keyword
                ? activeNode.files.filter((file) => file.toLowerCase().includes(keyword))
                : activeNode.files;
            statCategories.textContent = String(filteredFiles.length);

            const grid = document.createElement("div");
            grid.className = "grid sm:grid-cols-2 lg:grid-cols-3 gap-4";

            if (!filteredFiles.length) {
                const emptyGroup = document.createElement("div");
                emptyGroup.className = "text-sm text-slate-400 italic";
                emptyGroup.textContent = "Không có file phù hợp bộ lọc.";
                content.appendChild(emptyGroup);
                return;
            }

            const totalPages = Math.max(1, Math.ceil(filteredFiles.length / pageSize));
            if (currentPage > totalPages) {
                currentPage = 1;
            }
            const startIndex = (currentPage - 1) * pageSize;
            const pageItems = filteredFiles.slice(startIndex, startIndex + pageSize);

            pageItems.forEach((file) => {
                const relativePath = `${activeNode.path}/${file}`;
                const previewPath = normalizePath(getPreviewUrl(relativePath));
                const downloadPath = normalizePath(getDownloadUrl(relativePath));
                const card = document.createElement("button");
                card.type = "button";
                card.className = "border border-slate-200 rounded-xl overflow-hidden transition bg-white/80 card-hover text-left";
                card.dataset.src = previewPath;
                card.dataset.download = downloadPath;
                card.dataset.title = file;
                card.innerHTML = `
                    <div class="bg-slate-100">
                        <img src="${previewPath}" alt="${file}" class="w-full h-auto" onerror="this.src='https://via.placeholder.com/640x480?text=No+Preview'">
                    </div>
                `;
                grid.appendChild(card);
            });

            content.appendChild(grid);

            if (totalPages > 1) {
                const pagination = document.createElement("div");
                pagination.className = "mt-6 flex flex-wrap items-center justify-between gap-3";

                const info = document.createElement("div");
                info.className = "text-xs text-slate-500";
                info.textContent = `Trang ${currentPage} / ${totalPages} • ${filteredFiles.length} file`;

                const controls = document.createElement("div");
                controls.className = "flex items-center gap-2";

                const createBtn = (label, page, disabled = false) => {
                    const btn = document.createElement("button");
                    btn.className = `px-3 py-1.5 text-xs rounded-lg border ${disabled ? "text-slate-400 border-slate-200" : "text-slate-600 border-slate-300"}`;
                    btn.textContent = label;
                    btn.disabled = disabled;
                    if (!disabled) {
                        btn.addEventListener("click", () => {
                            currentPage = page;
                            renderContent();
                        });
                    }
                    return btn;
                };

                controls.appendChild(createBtn("Trước", Math.max(1, currentPage - 1), currentPage === 1));

                const maxPagesToShow = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
                let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
                if (endPage - startPage < maxPagesToShow - 1) {
                    startPage = Math.max(1, endPage - maxPagesToShow + 1);
                }

                for (let i = startPage; i <= endPage; i += 1) {
                    const isActive = i === currentPage;
                    const btn = document.createElement("button");
                    btn.className = `px-3 py-1.5 text-xs rounded-lg border ${isActive ? "btn-primary" : "btn-outline"}`;
                    btn.textContent = i;
                    btn.addEventListener("click", () => {
                        currentPage = i;
                        renderContent();
                    });
                    controls.appendChild(btn);
                }

                controls.appendChild(createBtn("Sau", Math.min(totalPages, currentPage + 1), currentPage === totalPages));

                pagination.appendChild(info);
                pagination.appendChild(controls);
                content.appendChild(pagination);
            }
            bindGroupActions();
        };

        const bindGroupActions = () => {
            document.querySelectorAll("#content button[data-src]").forEach((btn) => {
                btn.addEventListener("click", () => {
                    const src = btn.dataset.src;
                    const title = btn.dataset.title;
                    modalImage.src = src;
                    modalTitle.textContent = title;
                    modalPath.textContent = decodeURI(src);
                    modal.classList.remove("hidden");
                    document.body.classList.add("modal-open");
                });
            });
        };

        modalClose.addEventListener("click", () => {
            modal.classList.add("hidden");
            document.body.classList.remove("modal-open");
        });

        modal.addEventListener("click", (event) => {
            if (event.target === modal) {
                modal.classList.add("hidden");
                document.body.classList.remove("modal-open");
            }
        });

        document.getElementById("mobile-menu-btn").addEventListener("click", () => {
            document.getElementById("mobile-menu").classList.toggle("hidden");
        });

        searchInput.addEventListener("input", () => {
            currentPage = 1;
            renderContent();
        });

        const initData = () => {
            data = sampleData;
            activeParent = null;
            activeNode = null;
            buildNav();
            renderContent();
        };

        initData();
    </script>
</body>

</html>